<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.maker.mapper.ReviewMapper">
  <select id="selectMovieList" resultType="com.maker.domain.ReviewVO">
  	select * from movie
  </select>
  <insert id = "insert">
  	<selectKey keyProperty="rno" order="BEFORE"
  		resultType="long">
  		select seq_review.nextval from dual
  	</selectKey>
  	insert into review(rno, c_nick, r_comment, r_star, mno, cno)
	values(#{rno}, #{c_nick}, #{r_comment},
		#{r_star}, #{mno}, #{cno})
	</insert>
	<delete id="delete">
		delete from review where mno = #{mno}
	</delete>
	<select id="read" resultType="com.maker.domain.ReviewVO">
		select * from review
	</select>
	<select id="getList" resultType="com.maker.domain.ReviewVO">
		select * from review where mno = #{mno}
	</select>
	<select id="getview" resultType="com.maker.domain.ReviewVO">
		select * from review where rownum between 0 and 10 order by mno
	</select>
	<select id="lastview" resultType="com.maker.domain.ReviewVO">
		select * from review where rownum between 0 and 3 order by mno desc
	</select>
	<select id="readview" resultType="com.maker.domain.ReviewVO">
		select * from review where mno = #{mno}
	</select>
	<select id="sumStar" resultType="float">
		select NVL(SUM(r_star), 0.0) from review where mno = #{mno}
	</select>
	<!-- 총 게시글 갯수 출력 -->
	<select id="countReview" resultType="int">
		select count(*) from review where mno = #{mno}
	</select>
	<!-- 페이징 처리 후 게시글 조회 -->
	<select id="selectBoard" resultType="com.maker.domain.ReviewVO">
		select * from (
			select rownum rn, A.* from (
						select * 
						from review 
						where mno = ${mno}
						) A
					)
		where rn between #{start} and #{end}
	</select>
</mapper>